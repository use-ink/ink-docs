<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-faq/migrating-from-ink-4-to-5" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Migrating from ink! 4.x to 5.0 | ink! documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://use.ink/faq/migrating-from-ink-4-to-5"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migrating from ink! 4.x to 5.0 | ink! documentation"><meta data-rh="true" name="description" content="We&#x27;ve made a couple of breaking changes from ink! 4.x to ink! 5.0."><meta data-rh="true" property="og:description" content="We&#x27;ve made a couple of breaking changes from ink! 4.x to ink! 5.0."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://use.ink/faq/migrating-from-ink-4-to-5"><link data-rh="true" rel="alternate" href="https://use.ink/faq/migrating-from-ink-4-to-5" hreflang="en"><link data-rh="true" rel="alternate" href="https://use.ink/faq/migrating-from-ink-4-to-5" hreflang="x-default"><link rel="stylesheet" href="fonts/fonts.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Montserrat:wght@400;500;700&display=swap">
<script src="https://apisa.parity.io/latest.js" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.7d3b1889.css">
<script src="/assets/js/runtime~main.617e7cb4.js" defer="defer"></script>
<script src="/assets/js/main.150d5a1f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/text-black.svg"><link rel="preload" as="image" href="/img/text-white.svg"><link rel="preload" as="image" href="/img/title/migration-4.x-to-5.0.svg"><link rel="preload" as="image" href="/img/pallet-version.png"><link rel="preload" as="image" href="/img/chains/aleph-zero.svg"><link rel="preload" as="image" href="/img/chains/astar.svg"><link rel="preload" as="image" href="/img/chains/shiden.svg"><link rel="preload" as="image" href="/img/chains/phala.svg"><link rel="preload" as="image" href="/img/chains/pendulum.svg"><link rel="preload" as="image" href="/img/chains/amplitude.svg"><link rel="preload" as="image" href="/img/chains/ternoa.svg"><link rel="preload" as="image" href="/img/chains/krest.svg"><link rel="preload" as="image" href="/img/api-version-1.png"><link rel="preload" as="image" href="/img/cargo-contract-storage.png"><link rel="preload" as="image" href="/img/cargo-contract-info.png"><link rel="preload" as="image" href="/img/api-version-2.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/text-black.svg" alt="ink!" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/text-white.svg" alt="ink!" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/faq/migrating-from-ink-4-to-5">5.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/faq/migrating-from-ink-4-to-5">5.x</a></li><li><a class="dropdown__link" href="/6.x/faq/migrating-from-ink-4-to-5">6.x</a></li><li><a class="dropdown__link" href="/4.x/">4.x</a></li><li><a class="dropdown__link" href="/3.x/">3.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/getting-started/setup">Getting started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/basics/contract-template">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/basics/contract-testing/overview">Testing &amp; Debugging</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/macros-attributes">Macros &amp; Attributes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/datastructures/overview">Storage &amp; Data Structures</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/linter/overview">Linter</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/frontend/overview">Frontend Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/examples/smart-contracts">Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/standards/overview">Standards</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/funding-programs">Funding Programs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/getting-started/inkathon">Third Party Tools &amp; Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/faq">FAQ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/faq/migrating-from-ink-4-to-5">Migrating from ink! 4.x to 5.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/migrating-from-ink-3-to-4">Migrating from ink! 3.x to 4.0</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/brand-assets/ink">Brand Assets</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg id="prefix__Layer_1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 75 73.3" style="enable-background:new 0 0 75 73.3" xml:space="preserve" role="img" class="breadcrumbHomeIcon_YNFT"><style>.prefix__st0{opacity:.75}.prefix__st1{fill-rule:evenodd;clip-rule:evenodd;fill:#e3e3e3}.prefix__st2{fill:#fff}</style><g class="prefix__st0"><path class="prefix__st1" d="M6.9 47.1h2.4c8.8-26.7-22.6-20.4-2.4 0z"></path></g><g class="prefix__st0"><path class="prefix__st1" d="M6.9 49.1h2.4c8.8 26.7-22.6 20.4-2.4 0z"></path></g><g class="prefix__st0"><path class="prefix__st2" d="M12.2 50.6H5.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5h7.1c1.4 0 2.5 1.1 2.5 2.5s-1.1 2.5-2.5 2.5z"></path></g><g class="prefix__st0"><path class="prefix__st1" d="M37.4 19.7V5.9C37.4 2.7 40 0 43.3 0h11.9v10.7h-4.7c-1.2 0-2.2 1-2.2 2.2v6.7l-10.9.1z"></path></g><path d="m58.5 31.2-1.2-9.4c-.2-1.7-1.7-3-3.4-3H33.3c-1.7 0-3.2 1.3-3.4 3l-1.2 9.4h29.8z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff" class="prefix__st0"></path><g class="prefix__st0"><path class="prefix__st1" d="M43.6 22.9c-17.4 0-31.4 11.3-31.4 25.2s14.1 25.2 31.4 25.2S75 62 75 48.1 60.9 22.9 43.6 22.9zm0 36.5c-6.6 0-11.9-5.3-11.9-11.9S37 35.6 43.6 35.6 55.5 41 55.5 47.5s-5.4 11.9-11.9 11.9z"></path></g><path d="M38 52.8c-.6 0-1.3-.2-1.8-.7-1-1-1-2.6 0-3.5l8.4-8.4c1-1 2.6-1 3.5 0 1 1 1 2.6 0 3.5l-8.4 8.4c-.4.5-1 .7-1.7.7z" style="fill:#e3e3e3" class="prefix__st0"></path><g class="prefix__st0"><path class="prefix__st2" d="M43.6 63.7c-8.9 0-16.2-7.3-16.2-16.2s7.3-16.2 16.2-16.2 16.2 7.3 16.2 16.2-7.3 16.2-16.2 16.2zm0-27.3c-6.2 0-11.2 5-11.2 11.2s5 11.2 11.2 11.2 11.2-5 11.2-11.2-5.1-11.2-11.2-11.2z"></path></g><g class="prefix__st0"><path class="prefix__st2" d="M52.8 0h5v10.7h-5z"></path></g></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">FAQ</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migrating from ink! 4.x to 5.0</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 5.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Migrating from ink! 4.x to 5.0</h1></header><img src="/img/title/migration-4.x-to-5.0.svg" class="titlePic">
<p>We&#x27;ve made a couple of breaking changes from ink! 4.x to ink! 5.0.
On this page we outline how you can migrate existing dApps and
contracts from 4.x to 5.0.</p>
<p>This release addresses the majority of issues raised in <a href="https://blog.openzeppelin.com/security-review-ink-cargo-contract" target="_blank" rel="noopener noreferrer">the OpenZeppelin
security review</a>.
In particular, we addressed the proxy selector clashing attack.</p>
<p>You can find the full changelog of the 5.0 release <a href="https://github.com/use-ink/ink/blob/master/CHANGELOG.md#version-500" target="_blank" rel="noopener noreferrer">here</a>.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>This migration guide only considers your code base! Not your storage data!</p><p>If you have an existing contract on-chain you might not be able to just
upgrade the code on-chain, you possibly also have to migrate your storage data.</p><p>The relevant change that you have to take into consideration is
<a href="https://github.com/use-ink/ink/pull/1897" target="_blank" rel="noopener noreferrer">#1897</a>.
A data migration may be required when your contract reads data from storage and truncates
the data when decoding it.
We&#x27;ve described this in more detail below, in the section
<a href="#fail-when-decoding-from-storage-and-not-all-bytes-consumed">&quot;Fail when decoding from storage and not all bytes consumed&quot;</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-upgrade">How to upgrade<a href="#how-to-upgrade" class="hash-link" aria-label="Direct link to How to upgrade" title="Direct link to How to upgrade">​</a></h2>
<ul>
<li>Change the dependency versions of <code>ink</code> and <code>ink_e2e</code> in your contracts <code>Cargo.toml</code> to <code>5</code>.</li>
<li>Update your local <code>cargo-contract</code> installation to 4.0.</li>
<li>Read through this page.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="compatibility">Compatibility<a href="#compatibility" class="hash-link" aria-label="Direct link to Compatibility" title="Direct link to Compatibility">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="substratepolkadot-sdk">Substrate/Polkadot SDK<a href="#substratepolkadot-sdk" class="hash-link" aria-label="Direct link to Substrate/Polkadot SDK" title="Direct link to Substrate/Polkadot SDK">​</a></h3>
<p>There are four new functions that are only compatible from particular releases upwards:</p>
<ul>
<li>v2 of <code>call</code> and <code>instantiate</code>: <code>&gt;= polkadot-v1.8.0</code> and <code>substrate-contracts-node &gt;= v0.39.0</code>
(<a href="#call-and-instantiate-v2">explained here</a>).</li>
<li><code>lock_delegate_dependency</code> and <code>unlock_delegate_dependency</code>:
<code>&gt;= polkadot-v1.9.0</code> and <code>substrate-contracts-node &gt;= v0.40.0</code> (<a href="#upgradeable-contracts-delegate_dependency">explained here</a>).</li>
</ul>
<p>These four functions are all opt-in! None of them are required to use ink! 5.0, they are only
required if you want to access the particular functionality they provide.
Please see the linked explainers for more details about them.</p>
<p>If you are not using any of those four functions, the same requirements as for ink! 4.0 holds:</p>
<ul>
<li><code>pallet-contracts</code> &gt;= <code>polkadot-v0.9.37</code>.</li>
<li><code>substrate-contracts-node</code> &gt;= <code>v0.24.0</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-find-out-if-a-chain-is-compatible-with-ink-5">How do I find out if a chain is compatible with ink! 5?<a href="#how-do-i-find-out-if-a-chain-is-compatible-with-ink-5" class="hash-link" aria-label="Direct link to How do I find out if a chain is compatible with ink! 5?" title="Direct link to How do I find out if a chain is compatible with ink! 5?">​</a></h3>
<p>You can query <code>contracts::palletVersion()</code> via the chain state RPCs. It has to
be <code>&gt;= 9</code> for ink! 5.0 to be compatible, if you don&#x27;t use any of the four functions
mentioned above.
For the above mentioned four functions please see the respective sections on this page,
there we explain how to find out if a chain supports them there.</p>
<p>You can use the <a href="https://polkadot.js.org/apps/" target="_blank" rel="noopener noreferrer">polakdot.js app</a> to do this:
Developer » Chain State » <code>contracts</code> » <code>palletVersion()</code> » Click on the <code>+</code> on the right.</p>
<img src="/img/pallet-version.png">
<p>The following chains are in production and support ink! 5.0, if you are not using any of the
four functions mentioned above:</p>
<div class="row"><div class="col text--center"><a href="https://alephzero.org"><img src="/img/chains/aleph-zero.svg" class="chain"></a></div><div class="col text--center"><a href="https://astar.network"><img src="/img/chains/astar.svg" class="chain"></a></div><div class="col text--center"><a href="https://shiden.astar.network"><img src="/img/chains/shiden.svg" class="chain"></a></div></div>
<div class="row"><div class="col text--center"><a href="http://phala.network"><img src="/img/chains/phala.svg" class="chain"></a></div><div class="col text--center"><a href="https://pendulumchain.org"><img src="/img/chains/pendulum.svg" class="chain"></a></div><div class="col text--center"><a href="https://pendulumchain.org/amplitude"><img src="/img/chains/amplitude.svg" class="chain"></a></div></div>
<div class="row"><div class="col text--center"><a href="https://www.ternoa.network/"><img src="/img/chains/ternoa.svg" class="chain"></a></div><div class="col text--center"><a href="https://krest.peaq.network/"><img src="/img/chains/krest.svg" class="chain"></a></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cargo-contract-40"><code>cargo-contract</code> 4.0<a href="#cargo-contract-40" class="hash-link" aria-label="Direct link to cargo-contract-40" title="Direct link to cargo-contract-40">​</a></h3>
<p>Together with ink! 5.0 we&#x27;ve released <code>cargo-contract</code> 4.0.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75 75"><style>.st1{fill:#bc83fb}.st4{fill:#d8b7fb}</style><ellipse cx="37.5" cy="37.5" rx="38.92" ry="36.03" style="fill:#fff" transform="rotate(-45.001 37.501 37.497)"></ellipse><path d="M34.56 50.4s3.56 4.75 9.4-1.47c3.71-3.94 6.78-4.02 7.19-1.17.51 3.54-5.11 12.97-13.43 12.97z" class="st1"></path><path d="M37.5 66.74c-15.46 0-28.04-12.58-28.04-28.04 0-9.82 5-18.76 13.38-23.91.89-.55 2.05-.27 2.59.62.55.89.27 2.05-.62 2.59-7.25 4.46-11.58 12.19-11.58 20.7 0 13.38 10.89 24.27 24.27 24.27S61.77 52.08 61.77 38.7c0-8.5-4.33-16.24-11.58-20.69a1.886 1.886 0 0 1-.62-2.59c.55-.89 1.71-1.16 2.59-.62 8.38 5.15 13.38 14.09 13.38 23.91 0 15.44-12.58 28.03-28.04 28.03" class="st1"></path><path d="M37.5 60.73c-3.55 0-6.46-2.91-6.46-6.46V29.56c0-3.55 2.91-6.46 6.46-6.46s6.46 2.91 6.46 6.46v24.71c0 3.55-2.91 6.46-6.46 6.46" style="fill:#8747cc"></path><ellipse cx="37.49" cy="13.82" rx="5.51" ry="6.18" style="fill-rule:evenodd;clip-rule:evenodd;fill:#bc83fb" transform="rotate(-76.761 37.496 13.816)"></ellipse><ellipse cx="37.25" cy="51.86" class="st4" rx="3.54" ry="2.4" transform="rotate(-84.393 37.253 51.863)"></ellipse><ellipse cx="37.25" cy="39.35" class="st4" rx="4.39" ry="2.97" transform="rotate(-84.393 37.25 39.353)"></ellipse><path d="M43.96 29.55v7.86c0-4.78-2.03-7.84-5.29-7.75-2.38.06-5.25 3.51-7.63 6.05-3.7 3.95-6.78 3.22-7.18.37-.5-3.47 5.11-12.6 13.17-12.95.15-.01.31-.02.46-.02h.02c3.55 0 6.45 2.89 6.45 6.44" class="st1"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You have to use <code>cargo-contract</code> &gt;= 4.0 for ink! 5.0 contracts!</p><p>You can upgrade via:</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">cargo install cargo</span><span class="token operator" style="color:#e09142">-</span><span class="token plain">contract </span><span class="token operator" style="color:#e09142">-</span><span class="token operator" style="color:#e09142">-</span><span class="token plain">version </span><span class="token operator" style="color:#e09142">^</span><span class="token number" style="color:#e09142">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<p>Make sure that e.g. your CI also uses at least <code>cargo-contract</code> 4.0 with ink! v5.0.
If you have wrapper scripts around <code>cargo-contract</code>, you should
ensure that this version is enforced, otherwise users will get an error.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tooling--libraries">Tooling &amp; Libraries<a href="#tooling--libraries" class="hash-link" aria-label="Direct link to Tooling &amp; Libraries" title="Direct link to Tooling &amp; Libraries">​</a></h3>
<ul>
<li>Stable Rust &gt;= 1.75</li>
<li><code>cargo-contract</code> &gt;= v4.0</li>
<li><code>polkadot-js/api</code> and <code>polkadot-js/api-contract</code> &gt;= 10.12.1</li>
<li><a href="https://github.com/scio-labs/use-inkathon" target="_blank" rel="noopener noreferrer"><code>use-inkathon</code></a>: upgrade the <code>polkadot-js/api</code> and <code>polkadot-js/api-contract</code> dependencies in your project to &gt;= 10.12.1</li>
<li><a href="https://inkathon.xyz/" target="_blank" rel="noopener noreferrer">ink!athon</a> &gt;= 0.7.0</li>
<li><a href="https://github.com/Brushfam/typechain-polkadot" target="_blank" rel="noopener noreferrer"><code>typechain-polkadot</code></a> &gt;= 1.2.0</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="important-changes">Important Changes<a href="#important-changes" class="hash-link" aria-label="Direct link to Important Changes" title="Direct link to Important Changes">​</a></h2>
<p>We had to introduce a number of changes that require you to manually upgrade
your contract from 4.x to 5.0. The steps to do this are explained in this section.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scale-dependencies-were-moved-to-ink-entrance-crate"><code>scale</code> dependencies were moved to <code>ink</code> entrance crate<a href="#scale-dependencies-were-moved-to-ink-entrance-crate" class="hash-link" aria-label="Direct link to scale-dependencies-were-moved-to-ink-entrance-crate" title="Direct link to scale-dependencies-were-moved-to-ink-entrance-crate">​</a></h3>
<p>This change was done to ensure that you always use the correct scale dependency versions
with an ink! version. The relevant PR is <a href="https://github.com/use-ink/ink/pull/1890" target="_blank" rel="noopener noreferrer">#1890</a>.</p>
<p>We removed the requirement for contracts to have direct dependencies on <code>parity-scale-codec</code>
and <code>scale-info</code> in their <code>Cargo.toml</code>.
You can now remove those dependencies from your contracts <code>Cargo.toml</code>:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">ink = { version = &quot;4.3&quot;, default-features = false }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">-scale = { package = &quot;parity-scale-codec&quot;, version = &quot;3&quot;, default-features = false, features = [&quot;derive&quot;] }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">-scale-info = { version = &quot;2.6&quot;, default-features = false, features = [&quot;derive&quot;], optional = true }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Both crates have been re-exported from the <code>ink</code> umbrella crate: <code>ink::scale_info</code> and <code>ink::scale</code>.</p>
<p>We created a convenience macro to derive the re-exported traits <code>ink::scale::Encode</code>,
<code>ink::scale::Decode</code> and <code>ink::scale_info::TypeInfo</code>.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token comment" style="color:#6c6783">// Previously</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c4b9fe">#[scale::Encode, scale::Decode)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c4b9fe">#[cfg_attr(feature = </span><span class="token attribute attr-name string" style="color:#ffcc99">&quot;std&quot;</span><span class="token attribute attr-name" style="color:#c4b9fe">, derive(::scale_info::TypeInfo))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">enum</span><span class="token plain"> </span><span class="token type-definition class-name">Error</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Now</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c4b9fe">#[ink::scale_derive(Encode, Decode, TypeInfo)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">enum</span><span class="token plain"> </span><span class="token type-definition class-name">Error</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The documentation of the macro can be found <a href="https://docs.rs/ink/5.0.0/ink/attr.scale_derive.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="wildcard-selectors-only-one-other-message-is-allowed-in-the-contract-besides-the-wildcard-selector">Wildcard selectors: only one other message is allowed in the contract besides the wildcard selector<a href="#wildcard-selectors-only-one-other-message-is-allowed-in-the-contract-besides-the-wildcard-selector" class="hash-link" aria-label="Direct link to Wildcard selectors: only one other message is allowed in the contract besides the wildcard selector" title="Direct link to Wildcard selectors: only one other message is allowed in the contract besides the wildcard selector">​</a></h3>
<p>Following <a href="https://blog.openzeppelin.com/security-review-ink-cargo-contract" target="_blank" rel="noopener noreferrer">our security review by OpenZeppelin</a>,
we&#x27;ve tightened the usage of wildcard selectors.
With ink! 5.0 we allow only exactly one other contract message with a well-known reserved
selector to be defined. In ink! 4.x, more than one other message was allowed.</p>
<p>Read more in <a href="https://github.com/use-ink/ink/pull/1708" target="_blank" rel="noopener noreferrer">the PR</a> and <a href="https://github.com/use-ink/ink/issues/1676" target="_blank" rel="noopener noreferrer">IIP-2: Limit contracts with a wildcard selector to one other message</a>.</p>
<p>The proposal is to restrict contracts with a wildcard selector to only have one other message
with a reserved/well-known selector. This guarantees that there are no selector clashes,
either by chance or malicious intent, and that the Proxy will only handle messages intended for it.</p>
<p>If a contract uses a wildcard selector <code>#[ink(message, payable, selector = _)]</code> it <em>MAY</em> define one
other message. This message <em>MUST</em> use the reserved selector <code>@</code>.
This selector <em>MUST</em> only be used in conjunction with a wildcard selector.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token comment" style="color:#6c6783">/// Handles any message with no matching selector in this proxy contract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c4b9fe">#[ink(message, selector = _)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#9a86fd">fallback</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token keyword" style="color:#ffcc99">self</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// forward call to the &quot;logic&quot; contract which actually executes the call</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c4b9fe">#[ink::scale_derive(Decode)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">enum</span><span class="token plain"> </span><span class="token type-definition class-name">ProxyMessage</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token class-name">UpgradeContract</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name">Hash</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">/// One other message allowed to handle messages.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">/// Fails to compile unless `@` is used as the selector.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c4b9fe">#[ink(message, selector = @)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#9a86fd">handler</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token keyword" style="color:#ffcc99">self</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token class-name">ProxyMessage</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  </span><span class="token keyword" style="color:#ffcc99">match</span><span class="token plain"> msg </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token class-name">ProxyMessage</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">hash</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">/// An additional message. Fails to compile when uncommented.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// #[ink(message)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// pub fn additional_message(&amp;self, msg: ProxyMessage) {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">//    match msg {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">//        ProxyMessage(hash) =&gt; ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">//    }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="events-20">Events 2.0<a href="#events-20" class="hash-link" aria-label="Direct link to Events 2.0" title="Direct link to Events 2.0">​</a></h3>
<p>In prior ink! versions, events were defined inside the <code>#[ink::contract]</code> macro.
With ink! 5.0 we decouple events from the <code>#[ink::contract]</code> macro,
allowing events to be shared between contracts.
We&#x27;ve updated <a href="/basics/events">the Events documentation page</a> accordingly.</p>
<p>The syntax of defining events within the main <code>#[ink::contract]</code> macro will continue to work,
no code changes in existing contracts are required to update to the new syntax.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>The topic calculation changed in general, so also for events that are declared inside the
<code>#[ink::contract]</code> macro!</p><p>This is a breaking change for any client code which uses topics to filter events.</p><p>Please see <a href="https://github.com/use-ink/ink/pull/1827" target="_blank" rel="noopener noreferrer">#1827</a> for details.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="custom-signature-topics">Custom signature topics<a href="#custom-signature-topics" class="hash-link" aria-label="Direct link to Custom signature topics" title="Direct link to Custom signature topics">​</a></h4>
<p>In <a href="https://github.com/use-ink/ink/pull/2031" target="_blank" rel="noopener noreferrer">#2031</a> we introduced an
optional attribute <code>signature_topic</code> to the <code>#[ink::event]</code> and <code>#[ink(event)]</code> macros.
It can be used to specify the signature topic for a specific event manually, instead of the
automatic topic calculation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-more-unchecked-arithmetic">No more unchecked arithmetic<a href="#no-more-unchecked-arithmetic" class="hash-link" aria-label="Direct link to No more unchecked arithmetic" title="Direct link to No more unchecked arithmetic">​</a></h3>
<p>Unchecked arithmetic operations in a contract are no longer supported for arithmetic
safety reasons. Compiling a contract that contains those will fail gracefully.</p>
<p>If you haven&#x27;t already done, you now need to handle overflows that could occur.
Rust supports different possibilities of doing so (saturating, &quot;wrap around&quot;,
and unchecked arithmetic operations) .
See <a href="https://doc.rust-lang.org/book/ch03-02-data-types.html#scalar-types" target="_blank" rel="noopener noreferrer">this</a> section
of the Rust Programming Language for a thorough explanation on how to do safe arithmetic
operations in Rust.</p>
<p>This change was introduced in <a href="https://github.com/use-ink/ink/pull/1831" target="_blank" rel="noopener noreferrer">#1831</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fail-when-decoding-from-storage-and-not-all-bytes-consumed">Fail when decoding from storage and not all bytes consumed<a href="#fail-when-decoding-from-storage-and-not-all-bytes-consumed" class="hash-link" aria-label="Direct link to Fail when decoding from storage and not all bytes consumed" title="Direct link to Fail when decoding from storage and not all bytes consumed">​</a></h3>
<p>If a contract previously relied on successful decoding which does not consume all bytes,
then recompiling with a version of ink! which includes this change will cause that contract
to trap at runtime when attempting to decode.</p>
<p>A simple example would be if a storage cell contains some bytes which were in the first place
an encoded <code>u32</code>. If the contract attempts to decode those into a <code>u8</code>
this would previously have succeeded, now the contract would trap.</p>
<p>Here&#x27;s a code example of behavior that previously worked for ink! 4.x, but
would error now:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> key </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0u32</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> value </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0x42</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">32</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token namespace" style="opacity:0.7">ink</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">set_contract_storage</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token plain">key</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Only attempt to read the first byte (the `u8`) of the storage value data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> _loaded_value</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token class-name">Option</span><span class="token operator" style="color:#e09142">&lt;</span><span class="token keyword" style="color:#ffcc99">u8</span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">ink</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">get_contract_storage</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token plain">key</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">map_err</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token plain"> </span><span class="token macro property" style="color:#9a86fd">format!</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;get_contract_storage failed: {:?}&quot;</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token operator" style="color:#e09142">?</span><span class="token punctuation" style="color:#6c6783">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We introduced this change in <a href="https://github.com/use-ink/ink/pull/1897" target="_blank" rel="noopener noreferrer">#1897</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ink_e2e-api-changes">[ink_e2e] API Changes<a href="#ink_e2e-api-changes" class="hash-link" aria-label="Direct link to [ink_e2e] API Changes" title="Direct link to [ink_e2e] API Changes">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="builder-api">Builder API<a href="#builder-api" class="hash-link" aria-label="Direct link to Builder API" title="Direct link to Builder API">​</a></h4>
<p>In <a href="https://github.com/use-ink/ink/pull/1917" target="_blank" rel="noopener noreferrer">#1917</a> we reworked the E2E API with
a builder API.
<code>instantiate</code>, <code>call</code> and <code>upload</code> will now return a builder instance. You can
specify optional arguments with builder methods, and submit the call for on-chain
execution with the <code>.submit()</code> method, or dry-run it with <code>dry_run()</code>.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> contract </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">instantiate</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;flipper&quot;</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;</span><span class="token namespace" style="opacity:0.7">ink_e2e</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">alice</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;</span><span class="token keyword" style="color:#ffcc99">mut</span><span class="token plain"> constructor</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">submit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">expect</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;instantiate failed&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">mut</span><span class="token plain"> call_builder </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">call_builder</span><span class="token punctuation" style="color:#6c6783">::</span><span class="token operator" style="color:#e09142">&lt;</span><span class="token class-name">Flipper</span><span class="token operator" style="color:#e09142">&gt;</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> get </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> call_builder</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">get</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> get_res </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token namespace" style="opacity:0.7">ink_e2e</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">bob</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;</span><span class="token plain">get</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">dry_run</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token keyword" style="color:#ffcc99">await</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token macro property" style="color:#9a86fd">assert!</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token macro property" style="color:#9a86fd">matches!</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">get_res</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">return_value</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">false</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="extra-gas-margin">Extra gas margin<a href="#extra-gas-margin" class="hash-link" aria-label="Direct link to Extra gas margin" title="Direct link to Extra gas margin">​</a></h4>
<p>As part of <a href="https://github.com/use-ink/ink/pull/1917" target="_blank" rel="noopener noreferrer">#1917</a> we added the possibility
to specify a gas margin (in percentage) as part of the on-chain call.</p>
<p>There are cases when gas estimates may not necessarily be accurate enough due to the complexity
of the smart contract logic that adds additional overhead and gas consumption.
Therefore, it is helpful to allow to specify an extra portion of the gas to be added to the
limit (i.e. 5%, 10%).</p>
<p>The method <code>.extra_gas_portion(margin: u64)</code> method is part of the builder API:</p>
<ul>
<li><a href="https://docs.rs/ink_e2e/5.0.0/ink_e2e/struct.InstantiateBuilder.html#method.extra_gas_portion" target="_blank" rel="noopener noreferrer"><code>ink_e2e::InstantiateBuilder::extra_gas_portion</code></a></li>
<li><a href="https://docs.rs/ink_e2e/5.0.0/ink_e2e/struct.CallBuilder.html#method.extra_gas_portion" target="_blank" rel="noopener noreferrer"><code>ink_e2e::CallBuilder::extra_gas_portion</code></a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="improved-call-api">Improved <code>call()</code> API<a href="#improved-call-api" class="hash-link" aria-label="Direct link to improved-call-api" title="Direct link to improved-call-api">​</a></h4>
<p>We removed the <code>build_message()</code> function with its unhandy callback.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token comment" style="color:#6c6783">// Previously</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> first_insert </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">ink_e2e</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">build_message</span><span class="token punctuation" style="color:#6c6783">::</span><span class="token operator" style="color:#e09142">&lt;</span><span class="token class-name">MappingsRef</span><span class="token operator" style="color:#e09142">&gt;</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">contract_id</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token closure-params">contract</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token plain"> contract</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">insert_balance</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1_000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Now</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> first_insert </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">ink_e2e</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">build_message</span><span class="token punctuation" style="color:#6c6783">::</span><span class="token operator" style="color:#e09142">&lt;</span><span class="token class-name">MappingsRef</span><span class="token operator" style="color:#e09142">&gt;</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">contract_id</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">insert_balance</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1_000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See <a href="https://github.com/use-ink/ink/pull/1782" target="_blank" rel="noopener noreferrer">#1782</a> for more details.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="removed-additional_contracts-parameter">Removed <code>additional_contracts</code> parameter<a href="#removed-additional_contracts-parameter" class="hash-link" aria-label="Direct link to removed-additional_contracts-parameter" title="Direct link to removed-additional_contracts-parameter">​</a></h4>
<p><code>additional_contracts</code> parameter which is part of <code>#[ink_e2e:test]</code> has been removed in <a href="https://github.com/use-ink/ink/pull/2098" target="_blank" rel="noopener noreferrer">#2098</a>.
This information is now implied from the contract&#x27;s manifest.
Simply, add the other contract as dependency with the <code>ink-as-a-dependency</code> feature enabled.
The test will detect the contract and build it as part of the test.</p>
<h4></h4>
<p>In <a href="https://github.com/use-ink/ink/pull/2076" target="_blank" rel="noopener noreferrer">#2076</a>, we&#x27;ve added a new
<a href="https://docs.rs/ink_e2e/5.0.0/ink_e2e/trait.ContractsBackend.html#method.remove_code" target="_blank" rel="noopener noreferrer"><code>remove_code</code></a>
function to the E2E API:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> contract </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">remove_code</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token namespace" style="opacity:0.7">ink_e2e</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">alice</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> code_hash</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// Submit the call for on-chain execution.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">submit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">expect</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;remove failed&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-data-structure-storagevec">New Data Structure: <code>StorageVec</code><a href="#new-data-structure-storagevec" class="hash-link" aria-label="Direct link to new-data-structure-storagevec" title="Direct link to new-data-structure-storagevec">​</a></h3>
<p>We&#x27;ve added a <code>Vec</code>-like data structure, built on top of Mapping.</p>
<p>This allows to retrieve elements from a vector and grow it without
having to load and push all elements.
For <code>Vec</code>, the cost of reading or writing a single element grows linearly corresponding
to the number of elements in the vector (its length). Additionally, the maximum capacity
of the whole vector is limited by the size of <a href="https://github.com/use-ink/ink/blob/master/ARCHITECTURE.md#communication-with-the-pallet" target="_blank" rel="noopener noreferrer">ink!&#x27;s static buffer</a>
used during ABI encoding and decoding (default 16 KiB).
<code>StorageVec</code> on the other hand allows to access each element individually.</p>
<p>With a <code>Vec</code> it&#x27;s possible to e.g. introduce a security issue in your contract
where an attacker can fill the <code>Vec</code>, making it very costly for other users to
access it or write to it.</p>
<p>You can find verbatim documentation on <code>StorageVec</code> <a href="/datastructures/storagevec">here</a>.
The page explains when to use <code>StorageVec</code> and when not.
The Rust docs can be found <a href="https://docs.rs/ink/5.0.0/ink/storage/struct.StorageVec.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fallible-methods-for-lazy-mapping-storagevec">Fallible methods for <code>Lazy</code>, <code>Mapping</code>, <code>StorageVec</code><a href="#fallible-methods-for-lazy-mapping-storagevec" class="hash-link" aria-label="Direct link to fallible-methods-for-lazy-mapping-storagevec" title="Direct link to fallible-methods-for-lazy-mapping-storagevec">​</a></h3>
<p>In <a href="https://github.com/use-ink/ink/pull/1910" target="_blank" rel="noopener noreferrer">#1910</a> we added <code>try_*</code> methods for
reading and writing <code>Lazy</code> and <code>Mapping</code> values to and from storage.
The try methods correspond to <code>Mapping::{insert, get, take}</code>, <code>Lazy::{set, get}</code>.
For <code>StorageVec::{peek, get, set, pop, push}</code> we added <code>try_*</code> methods in
<a href="https://github.com/use-ink/ink/pull/1995" target="_blank" rel="noopener noreferrer">#1995</a>.</p>
<p>Please see the individual Rust docs for these new methods:</p>
<ul>
<li><a href="https://docs.rs/ink/5.0.0/ink/storage/struct.StorageVec.html" target="_blank" rel="noopener noreferrer"><code>StorageVec</code></a></li>
<li><a href="https://docs.rs/ink/5.0.0/ink/storage/struct.Lazy.html" target="_blank" rel="noopener noreferrer"><code>Lazy</code></a></li>
<li><a href="https://docs.rs/ink/5.0.0/ink/storage/struct.Mapping.html" target="_blank" rel="noopener noreferrer"><code>Mapping</code></a>. For <code>Mapping</code>, the encoded size of the key is also accounted for.</li>
</ul>
<p>You should use the <code>try_*</code> methods for dynamically sized values, unless you made sure
otherwise they will fit into the static buffer. The <a href="https://github.com/use-ink/ink/blob/master/ARCHITECTURE.md#communication-with-the-pallet" target="_blank" rel="noopener noreferrer">static buffer in ink!</a>
is 16 kB by default.</p>
<p>We added a lint to <code>cargo-contract</code> 4.0 that will detect
potentially unsafe uses of methods for which there are safer alternatives:
<a href="/linter/rules/non_fallible_api"><code>non_fallible_api</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="chain-extension-api-changed--support-for-multiple-chain-extensions">Chain Extension API changed + Support for multiple chain extensions<a href="#chain-extension-api-changed--support-for-multiple-chain-extensions" class="hash-link" aria-label="Direct link to Chain Extension API changed + Support for multiple chain extensions" title="Direct link to Chain Extension API changed + Support for multiple chain extensions">​</a></h3>
<p>With <a href="https://github.com/use-ink/ink/pull/1958" target="_blank" rel="noopener noreferrer">#1958</a> we added support for interacting with
multiple chain extensions from ink!. This is a breaking change.</p>
<p>You can now e.g. have a contract that utilizes a PSP22 chain extension together with one
for random numbers.</p>
<p>The syntax for chain extension functions changed slightly:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">-#[ink(extension = 0xfecb)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+#[ink(function = 0xfecb)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">fn foo() {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The argument type changed from <code>u32</code> to <code>u16</code>:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">-/// `#[ink(extension = N: u32)]`</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">-Extension,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+/// `#[ink(function = N: u16)]`</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+Function,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The top level macro <code>#[ink::chain_extension]</code> now <em>requires</em> an <code>(extension = N: u16)</code> argument to support multiple chain extensions.
If you are using only one extension, the ID can be any <code>u16</code> number,
otherwise please consult the <a href="/macros-attributes/chain-extension"><code>#[ink::chain_extension]</code> macro documentation</a></p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">-#[ink::chain_extension]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+#[ink::chain_extension(extension = 1)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75 75"><style>.st1{fill:#bc83fb}.st4{fill:#d8b7fb}</style><ellipse cx="37.5" cy="37.5" rx="38.92" ry="36.03" style="fill:#fff" transform="rotate(-45.001 37.501 37.497)"></ellipse><path d="M34.56 50.4s3.56 4.75 9.4-1.47c3.71-3.94 6.78-4.02 7.19-1.17.51 3.54-5.11 12.97-13.43 12.97z" class="st1"></path><path d="M37.5 66.74c-15.46 0-28.04-12.58-28.04-28.04 0-9.82 5-18.76 13.38-23.91.89-.55 2.05-.27 2.59.62.55.89.27 2.05-.62 2.59-7.25 4.46-11.58 12.19-11.58 20.7 0 13.38 10.89 24.27 24.27 24.27S61.77 52.08 61.77 38.7c0-8.5-4.33-16.24-11.58-20.69a1.886 1.886 0 0 1-.62-2.59c.55-.89 1.71-1.16 2.59-.62 8.38 5.15 13.38 14.09 13.38 23.91 0 15.44-12.58 28.03-28.04 28.03" class="st1"></path><path d="M37.5 60.73c-3.55 0-6.46-2.91-6.46-6.46V29.56c0-3.55 2.91-6.46 6.46-6.46s6.46 2.91 6.46 6.46v24.71c0 3.55-2.91 6.46-6.46 6.46" style="fill:#8747cc"></path><ellipse cx="37.49" cy="13.82" rx="5.51" ry="6.18" style="fill-rule:evenodd;clip-rule:evenodd;fill:#bc83fb" transform="rotate(-76.761 37.496 13.816)"></ellipse><ellipse cx="37.25" cy="51.86" class="st4" rx="3.54" ry="2.4" transform="rotate(-84.393 37.253 51.863)"></ellipse><ellipse cx="37.25" cy="39.35" class="st4" rx="4.39" ry="2.97" transform="rotate(-84.393 37.25 39.353)"></ellipse><path d="M43.96 29.55v7.86c0-4.78-2.03-7.84-5.29-7.75-2.38.06-5.25 3.51-7.63 6.05-3.7 3.95-6.78 3.22-7.18.37-.5-3.47 5.11-12.6 13.17-12.95.15-.01.31-.02.46-.02h.02c3.55 0 6.45 2.89 6.45 6.44" class="st1"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the chain extension was not used in a tuple in the runtime configuration,
<code>extension = N: u16</code> can take any <code>u16</code> number.</p></div></div>
<p>A migration in most cases should just be to rename <code>#[ink(extension = …)]</code> to
<code>#[ink(function = …)]</code>, and specifying <code>extension</code> argument in top level macro.</p>
<p>We added an example contract that illustrates the usage of multiple chain extensions
in one contract:
<a href="https://github.com/use-ink/ink-examples/tree/main/combined-extension" target="_blank" rel="noopener noreferrer"><code>combined-extension</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="call-and-instantiate-v2"><code>call</code> and <code>instantiate</code> v2<a href="#call-and-instantiate-v2" class="hash-link" aria-label="Direct link to call-and-instantiate-v2" title="Direct link to call-and-instantiate-v2">​</a></h3>
<p>The functions to instantiate and call other contracts got an upgrade in the
<code>polkadot-v1.8.0</code> release (in the <a href="https://github.com/paritytech/polkadot-sdk/commit/d250a6e4270a77f28e2737a4faa3fb78c8ea7a85" target="_blank" rel="noopener noreferrer"><code>d250a6</code></a> commit),
The new v2 of them allows passing both <code>Weight</code> parts (<code>ref_time_limit</code> and <code>proof_size_limit</code>),
as well as the <code>storage_deposit_limit</code>.</p>
<p>The previous v1 <code>call</code> and <code>instantiate</code> functions only provided a single <code>gas_limit</code> parameter,
which was used as the value for <code>ref_time_limit</code>.
You can still use these <code>v1</code> versions.
For <code>call</code> on a call builder obtained through
<a href="https://docs.rs/ink_env/5.0.0/ink_env/call/fn.build_call.html" target="_blank" rel="noopener noreferrer"><code>build_call</code></a>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">call_builder</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  .call_v1()</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  .gas_limit(ref_time_limit)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  .invoke();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For <code>instantiate</code> on <a href="https://docs.rs/ink_env/5.0.0/ink_env/call/fn.build_create.html" target="_blank" rel="noopener noreferrer"><code>build_create</code></a>:</p>
<p>The new <code>v2</code> parameters can be set like so:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">call_builder </span><span class="token comment" style="color:#6c6783">// or `create_builder`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">ref_time_limit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">ref_time_limit</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">proof_size_limit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">proof_size_limit</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">storage_deposit_limit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">storage_deposit_limit</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  </span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">invoke</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can find out if a chain supports the new <code>v2</code> functions for call/instantiate by
querying the <code>contracts::apiVersion</code> constant. It has to be <code>1</code>.
You can use the <a href="https://polkadot.js.org/apps/" target="_blank" rel="noopener noreferrer">polakdot.js app</a> to do this:
Developer » Chain State » Constants » <code>contracts</code> » <code>apiVersion</code> » Click on the <code>+</code> on the right.</p>
<img src="/img/api-version-1.png">
<p>At the time of the ink! v5 release (March 2024) no parachain with ink! support
had upgraded to <code>polkadot-v1.8.0</code> yet.</p>
<p>Please note that if you are using trait definitions for cross-contract calls,
direct calls from the <code>contract_ref!</code> macro are only supported with the <code>call_v2</code>.
Otherwise, you need to get the <code>CallBuilder</code> from the structure
and build the call manually.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">type</span><span class="token plain"> </span><span class="token type-definition class-name">Erc20Wrapper</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token macro property" style="color:#9a86fd">contract_ref!</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name">Erc20</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> erc20</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token class-name">Erc20Wrapper</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> new_erc20</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">into</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">let</span><span class="token plain"> erc20_builder </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> erc20</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">erc20_builder</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">total_supply</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">call_v1</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">invoke</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-changes">Metadata Changes<a href="#metadata-changes" class="hash-link" aria-label="Direct link to Metadata Changes" title="Direct link to Metadata Changes">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="events-20-1">Events 2.0<a href="#events-20-1" class="hash-link" aria-label="Direct link to Events 2.0" title="Direct link to Events 2.0">​</a></h4>
<p>See <a href="https://github.com/use-ink/ink/pull/1827" target="_blank" rel="noopener noreferrer">#1827</a> for the full details.
Two fields werere added to the objects in the <code>events</code> array:
<code>module_path</code> and <code>signature_topic</code>.</p>
<p>Previously the order of the events in the <code>events</code> array was significant (i.e. the first
one had an implied index of <code>0</code>), and this index could be used to determine which event
to decode.
Now that is replaced by the <code>signature_topic</code>, and the order of the events in the metadata
no longer has any significance.</p>
<p>See the section &quot;<a href="#events-20">Events 2.0</a>&quot; on this page for more info.</p>
<p>ink! 4.0:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token property" style="color:#9a86fd">&quot;events&quot;</span><span class="token operator" style="color:#e09142">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">      </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token property" style="color:#9a86fd">&quot;args&quot;</span><span class="token operator" style="color:#e09142">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain"> ... </span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token property" style="color:#9a86fd">&quot;docs&quot;</span><span class="token operator" style="color:#e09142">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain"> ... </span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token property" style="color:#9a86fd">&quot;label&quot;</span><span class="token operator" style="color:#e09142">:</span><span class="token plain"> </span><span class="token string" style="color:#ffcc99">&quot;Transfer&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">      </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  </span><span class="token punctuation" style="color:#6c6783">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ink! 5.0:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">    &quot;events&quot;: [</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &quot;args&quot;: [ ... ],</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &quot;docs&quot;: [ ... ],</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &quot;label&quot;: &quot;...&quot;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+       &quot;module_path&quot;: &quot;erc20::erc20&quot;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+       &quot;signature_topic&quot;: &quot;0xb5b61a3e6a21a16be4f044b517c28ac692492f73c5bfd3f60178ad98c767f4cb&quot;</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">  ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-field-staticbuffersize">New field: <code>staticBufferSize</code><a href="#new-field-staticbuffersize" class="hash-link" aria-label="Direct link to new-field-staticbuffersize" title="Direct link to new-field-staticbuffersize">​</a></h4>
<p>With <a href="https://github.com/use-ink/ink/pull/1880" target="_blank" rel="noopener noreferrer">#1880</a> we added a <code>&quot;staticBufferSize&quot;</code> field to
the metadata file. The unit is bytes.</p>
<p>See the section &quot;<a href="#buffer-size-can-be-customized">Buffer size can be customized</a>&quot; on this page for
more info.</p>
<p>Example:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">      &quot;maxEventTopics&quot;: 4,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+     &quot;staticBufferSize&quot;: 16384,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">      &quot;timestamp&quot;: { ... }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-storage-keys-encoding-change">Metadata storage keys encoding change<a href="#metadata-storage-keys-encoding-change" class="hash-link" aria-label="Direct link to Metadata storage keys encoding change" title="Direct link to Metadata storage keys encoding change">​</a></h4>
<p>Storage keys used to access storage data are SCALE encoded. Previously,
the contract metadata used big endian encoding to represent storage keys.
With the ink! 5.0 release, these encoding formats have been aligned,
and SCALE encoding (little endian) is now used for the metadata storage keys.
This is a breaking change, and client tools that use the storage keys from contract
metadata will need to adapt accordingly.</p>
<p>Please see: <a href="https://github.com/use-ink/ink/pull/2048" target="_blank" rel="noopener noreferrer">#2048</a> for details.</p>
<p>Example:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">    &quot;storage&quot;: {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &quot;root&quot;: {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &quot;layout&quot;: {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            &quot;struct&quot;: {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            &quot;fields&quot;: [</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                &quot;layout&quot;: {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    &quot;leaf&quot;: {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">-                   &quot;key&quot;: &quot;0x00000159&quot;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+                   &quot;key&quot;: &quot;0x59010000&quot;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    &quot;ty&quot;: 0</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                &quot;name&quot;: &quot;value&quot;</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            &quot;name&quot;: &quot;Flipper&quot;</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">-       &quot;root_key&quot;: &quot;0x00000159&quot;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">+       &quot;root_key&quot;: &quot;0x59010000&quot;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &quot;ty&quot;: 1</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    },</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="interesting-new-features">Interesting New Features<a href="#interesting-new-features" class="hash-link" aria-label="Direct link to Interesting New Features" title="Direct link to Interesting New Features">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="end-to-end-testing-with-a-chain-snapshot">End-To-End testing with a chain snapshot<a href="#end-to-end-testing-with-a-chain-snapshot" class="hash-link" aria-label="Direct link to End-To-End testing with a chain snapshot" title="Direct link to End-To-End testing with a chain snapshot">​</a></h3>
<p>With ink! 5.0 we introduce the possibility of running your tests against the
fork (i.e. snapshot) of a live chain.</p>
<p>See <a href="/basics/contract-testing/chain-snapshot">this page</a> in our documentation for details.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-lints">New lints<a href="#new-lints" class="hash-link" aria-label="Direct link to New lints" title="Direct link to New lints">​</a></h3>
<p>The new lints are:</p>
<ul>
<li><a href="/linter/rules/no_main"><code>no_main</code></a>: enforces <code>no_main</code> for  contracts.</li>
<li><a href="/linter/rules/primitive_topic"><code>primitive_topic</code></a>: no number types are allowed as event topics.</li>
<li><a href="/linter/rules/storage_never_freed"><code>storage_never_freed</code></a>: what is written into storage can be removed again.</li>
<li><a href="/linter/rules/strict_balance_equality"><code>strict_balance_equality</code></a>: detects usage of strict balance equality checks, a common smart contract vulnerability.</li>
<li><a href="/linter/rules/non_fallible_api"><code>non_fallible_api</code></a>: detects the usage of potentially unsafe methods for which there are safer alternatives.</li>
</ul>
<p>With <code>cargo-contract</code> 4.0 we added a couple new lints for common smart contract issues
and best practices.
You can run the linter via <code>cargo contract build --lint</code>.</p>
<p>Details on each lint can be found <a href="/linter/overview">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-cargo-contract-commands">New <code>cargo-contract</code> commands<a href="#new-cargo-contract-commands" class="hash-link" aria-label="Direct link to new-cargo-contract-commands" title="Direct link to new-cargo-contract-commands">​</a></h3>
<p>We added a bunch of helpful new commands to <code>cargo-contract</code> 4.0.
For all these commands you can also supply the <code>--help</code> cli flag to get more
info (e.g. <code>cargo contract storage --help</code>).</p>
<ul>
<li><code>cargo contract verify</code>: contract verification (<a href="https://github.com/use-ink/cargo-contract/pull/1404" target="_blank" rel="noopener noreferrer">#1404</a>, <a href="https://github.com/use-ink/cargo-contract/pull/1306" target="_blank" rel="noopener noreferrer">#1306</a>)</li>
<li><code>cargo contract info</code> now outputs the language of the deployed contract, using a heuristic (<a href="https://github.com/use-ink/cargo-contract/pull/1329" target="_blank" rel="noopener noreferrer">#1329</a>)</li>
<li><code>cargo contract info --binary</code>: outputs the on-chain Wasm of the contract (<a href="https://github.com/use-ink/cargo-contract/pull/1311/" target="_blank" rel="noopener noreferrer">#1311</a>)</li>
<li><code>cargo contract info --all</code>: displays all addresses of deployed contracts on a particular chain (<a href="https://github.com/use-ink/cargo-contract/pull/1319" target="_blank" rel="noopener noreferrer">#1319</a>)</li>
<li><code>cargo contract storage</code>: displays the storage of an on-chain contract (<a href="https://github.com/use-ink/cargo-contract/pull/1395" target="_blank" rel="noopener noreferrer">#1395</a>, <a href="https://github.com/use-ink/cargo-contract/pull/1414" target="_blank" rel="noopener noreferrer">#1414</a>)</li>
</ul>
<img src="/img/cargo-contract-storage.png">
<br>
<img src="/img/cargo-contract-info.png">
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-off-chain-e2e-testing-backend-support-drink">Alternative off-chain E2E testing backend support: DRink!<a href="#alternative-off-chain-e2e-testing-backend-support-drink" class="hash-link" aria-label="Direct link to Alternative off-chain E2E testing backend support: DRink!" title="Direct link to Alternative off-chain E2E testing backend support: DRink!">​</a></h3>
<p>DRink! is a toolbox for ink! developers that allows for testing your contracts
without any running node.</p>
<p>It has a number of features that are pretty great:</p>
<ul>
<li>deploy and call your contracts synchronously, <em>without any delays</em> related to block production or networking.</li>
<li>enhanced debugging and call tracing.</li>
<li>supports <em>arbitrary runtime</em> configurations, including custom chain extensions and runtime calls.</li>
<li>full control over runtime state, including block number, timestamp, etc.</li>
</ul>
<p>See the <a href="https://github.com/inkdevhub/drink" target="_blank" rel="noopener noreferrer">DRink!</a> page for more details.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="contract-verification">Contract Verification<a href="#contract-verification" class="hash-link" aria-label="Direct link to Contract Verification" title="Direct link to Contract Verification">​</a></h3>
<p>We added a bunch of helpful documentation and <code>cargo-contract</code> commands for
contract verification. <a href="/basics/verification/contract-verification">Read more here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="we-improved-the-contract-example-illustrating-upgradeable-contracts-via-delegate_call">We improved the contract example illustrating upgradeable contracts via <code>delegate_call</code><a href="#we-improved-the-contract-example-illustrating-upgradeable-contracts-via-delegate_call" class="hash-link" aria-label="Direct link to we-improved-the-contract-example-illustrating-upgradeable-contracts-via-delegate_call" title="Direct link to we-improved-the-contract-example-illustrating-upgradeable-contracts-via-delegate_call">​</a></h3>
<p>See <a href="https://github.com/use-ink/ink-examples/tree/main/upgradeable-contracts" target="_blank" rel="noopener noreferrer">here</a>
for the contract example.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgradeable-contracts-delegate_dependency">Upgradeable Contracts: <code>delegate_dependency</code><a href="#upgradeable-contracts-delegate_dependency" class="hash-link" aria-label="Direct link to upgradeable-contracts-delegate_dependency" title="Direct link to upgradeable-contracts-delegate_dependency">​</a></h3>
<p>We&#x27;ve added support for two new host functions:</p>
<ul>
<li><code>lock_delegate_dependency</code>: prevents the code at the given code hash from being removed.</li>
<li><code>unlock_delegate_dependency</code>: releases the lock on preventing the code from being removed
from the current contract.</li>
</ul>
<p>Having a delegate dependency allows contracts to safely delegate to another <code>code_hash</code> with
the guarantee that it cannot be deleted.</p>
<p>We&#x27;ve updated the <a href="https://github.com/use-ink/ink-examples/tree/main/upgradeable-contracts#delegator" target="_blank" rel="noopener noreferrer"><code>upgradeable-contracts/delegator</code></a>
example to demonstrate these new calls.
For that purpose we&#x27;ve also added a <a href="https://docs.rs/ink_e2e/5.0.0/ink_e2e/trait.ContractsBackend.html#method.remove_code" target="_blank" rel="noopener noreferrer"><code>remove_code</code></a>
function to the E2E API.</p>
<p>These two functions are only available from <code>polkadot-1.8.0</code> on.
You can find out if a chain supports these new functions by
querying the <code>contracts::apiVersion</code> constant. It has to be <code>2</code>.
You can use the <a href="https://polkadot.js.org/apps/" target="_blank" rel="noopener noreferrer">polakdot.js app</a> to do this:
Developer » Chain State » Constants » <code>contracts</code> » <code>apiVersion</code> » Click on the <code>+</code> on the right.</p>
<img src="/img/api-version-2.png">
<p>At the time of the ink! v5 release (March 2024) no parachain with ink! support
had upgraded to <code>polkadot-v1.8.0</code> yet.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="we-made-set_code_hash-generic">We made <code>set_code_hash</code> generic<a href="#we-made-set_code_hash-generic" class="hash-link" aria-label="Direct link to we-made-set_code_hash-generic" title="Direct link to we-made-set_code_hash-generic">​</a></h3>
<p>The <code>self.env().set_code_hash()</code> method now accepts the <code>Hash</code> environment type instead
of a concrete <code>[u8; 32]</code>.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token comment" style="color:#6c6783">// Previously</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#9a86fd">set_code</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token keyword" style="color:#ffcc99">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">self</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> code_hash</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">[</span><span class="token keyword" style="color:#ffcc99">u8</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">32</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token namespace" style="opacity:0.7">ink</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">::</span><span class="token function" style="color:#9a86fd">set_code_hash</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token plain">code_hash</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">unwrap_or_else</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token closure-params">err</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Now</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#9a86fd">set_code</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token keyword" style="color:#ffcc99">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">self</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> code_hash</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token class-name">Hash</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">self</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">env</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">set_code_hash</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">&amp;</span><span class="token plain">code_hash</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">unwrap_or_else</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token closure-params">err</span><span class="token closure-params closure-punctuation punctuation" style="color:#6c6783">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>More details in <a href="https://github.com/use-ink/ink/pull/1906" target="_blank" rel="noopener noreferrer">#1906</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffer-size-can-be-customized">Buffer size can be customized<a href="#buffer-size-can-be-customized" class="hash-link" aria-label="Direct link to Buffer size can be customized" title="Direct link to Buffer size can be customized">​</a></h3>
<p>With <a href="https://github.com/use-ink/ink/pull/1869" target="_blank" rel="noopener noreferrer">#1869</a> we added a possibility
of setting a custom static buffer size for ink! to use.</p>
<p>ink! uses a static buffer for interacting with pallet-contracts, i.e. to move data
between <code>pallet-contracts</code> and a smart contract. The advantage of a static buffer
is that no gas-expensive heap allocations are necessary, all allocations are done
using simple pointer arithmetic.</p>
<p>The default static buffer size is 16 kB, which is enough for on-chain smart
contracts. However, the <a href="https://phala.network/" target="_blank" rel="noopener noreferrer">Phala Network</a> parachain on Polkadot
allows the deployment of ink! contracts off-chain. Hence, for their chain certain high
computation contracts might require a larger buffer size.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stabilized-call_runtime">Stabilized <code>call_runtime</code><a href="#stabilized-call_runtime" class="hash-link" aria-label="Direct link to stabilized-call_runtime" title="Direct link to stabilized-call_runtime">​</a></h3>
<p>We stabilized <code>call_runtime</code> in <a href="https://github.com/use-ink/ink/pull/1749" target="_blank" rel="noopener noreferrer">#1749</a>.
It can be used to call a runtime dispatchable from an ink! contract.</p>
<p>You can find a contract example and a comparison with chain extensions
<a href="https://github.com/use-ink/ink-examples/tree/main/call-runtime" target="_blank" rel="noopener noreferrer">here</a>.
We&#x27;ve added an example of how to end-to-end test
<code>call_runtime</code> <a href="https://github.com/use-ink/ink-examples/tree/main/e2e-call-runtime" target="_blank" rel="noopener noreferrer">here</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/use-ink/ink-docs/edit/master/docs/faq/migrating-from-ink-4-to-5.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/faq"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Frequently Asked Questions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/faq/migrating-from-ink-3-to-4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrating from ink! 3.x to 4.0</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-upgrade" class="table-of-contents__link toc-highlight">How to upgrade</a></li><li><a href="#compatibility" class="table-of-contents__link toc-highlight">Compatibility</a><ul><li><a href="#substratepolkadot-sdk" class="table-of-contents__link toc-highlight">Substrate/Polkadot SDK</a></li><li><a href="#how-do-i-find-out-if-a-chain-is-compatible-with-ink-5" class="table-of-contents__link toc-highlight">How do I find out if a chain is compatible with ink! 5?</a></li><li><a href="#cargo-contract-40" class="table-of-contents__link toc-highlight"><code>cargo-contract</code> 4.0</a></li><li><a href="#tooling--libraries" class="table-of-contents__link toc-highlight">Tooling &amp; Libraries</a></li></ul></li><li><a href="#important-changes" class="table-of-contents__link toc-highlight">Important Changes</a><ul><li><a href="#scale-dependencies-were-moved-to-ink-entrance-crate" class="table-of-contents__link toc-highlight"><code>scale</code> dependencies were moved to <code>ink</code> entrance crate</a></li><li><a href="#wildcard-selectors-only-one-other-message-is-allowed-in-the-contract-besides-the-wildcard-selector" class="table-of-contents__link toc-highlight">Wildcard selectors: only one other message is allowed in the contract besides the wildcard selector</a></li><li><a href="#events-20" class="table-of-contents__link toc-highlight">Events 2.0</a></li><li><a href="#no-more-unchecked-arithmetic" class="table-of-contents__link toc-highlight">No more unchecked arithmetic</a></li><li><a href="#fail-when-decoding-from-storage-and-not-all-bytes-consumed" class="table-of-contents__link toc-highlight">Fail when decoding from storage and not all bytes consumed</a></li><li><a href="#ink_e2e-api-changes" class="table-of-contents__link toc-highlight">[ink_e2e] API Changes</a></li><li><a href="#new-data-structure-storagevec" class="table-of-contents__link toc-highlight">New Data Structure: <code>StorageVec</code></a></li><li><a href="#fallible-methods-for-lazy-mapping-storagevec" class="table-of-contents__link toc-highlight">Fallible methods for <code>Lazy</code>, <code>Mapping</code>, <code>StorageVec</code></a></li><li><a href="#chain-extension-api-changed--support-for-multiple-chain-extensions" class="table-of-contents__link toc-highlight">Chain Extension API changed + Support for multiple chain extensions</a></li><li><a href="#call-and-instantiate-v2" class="table-of-contents__link toc-highlight"><code>call</code> and <code>instantiate</code> v2</a></li><li><a href="#metadata-changes" class="table-of-contents__link toc-highlight">Metadata Changes</a></li></ul></li><li><a href="#interesting-new-features" class="table-of-contents__link toc-highlight">Interesting New Features</a><ul><li><a href="#end-to-end-testing-with-a-chain-snapshot" class="table-of-contents__link toc-highlight">End-To-End testing with a chain snapshot</a></li><li><a href="#new-lints" class="table-of-contents__link toc-highlight">New lints</a></li><li><a href="#new-cargo-contract-commands" class="table-of-contents__link toc-highlight">New <code>cargo-contract</code> commands</a></li><li><a href="#alternative-off-chain-e2e-testing-backend-support-drink" class="table-of-contents__link toc-highlight">Alternative off-chain E2E testing backend support: DRink!</a></li><li><a href="#contract-verification" class="table-of-contents__link toc-highlight">Contract Verification</a></li><li><a href="#we-improved-the-contract-example-illustrating-upgradeable-contracts-via-delegate_call" class="table-of-contents__link toc-highlight">We improved the contract example illustrating upgradeable contracts via <code>delegate_call</code></a></li><li><a href="#upgradeable-contracts-delegate_dependency" class="table-of-contents__link toc-highlight">Upgradeable Contracts: <code>delegate_dependency</code></a></li><li><a href="#we-made-set_code_hash-generic" class="table-of-contents__link toc-highlight">We made <code>set_code_hash</code> generic</a></li><li><a href="#buffer-size-can-be-customized" class="table-of-contents__link toc-highlight">Buffer size can be customized</a></li><li><a href="#stabilized-call_runtime" class="table-of-contents__link toc-highlight">Stabilized <code>call_runtime</code></a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>