<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-intro/migrate-to-parachain" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Migrating an ink! contract to a Parachain Runtime | ink! documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://use.ink/migrate-ink-contracts-to-polkadot-frame-parachain"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migrating an ink! contract to a Parachain Runtime | ink! documentation"><meta data-rh="true" name="description" content="Smart contracts written in ink! are a great starting point for developing applications in the Polkadot ecosystem. Developers can go from an idea to a fully functioning web3 application &quot;in production&quot; in a matter of hours or days. This allows faster feedback on ideas, to validate whether there is user demand in the first place, and to easily iterate and refine the implementation."><meta data-rh="true" property="og:description" content="Smart contracts written in ink! are a great starting point for developing applications in the Polkadot ecosystem. Developers can go from an idea to a fully functioning web3 application &quot;in production&quot; in a matter of hours or days. This allows faster feedback on ideas, to validate whether there is user demand in the first place, and to easily iterate and refine the implementation."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://use.ink/migrate-ink-contracts-to-polkadot-frame-parachain"><link data-rh="true" rel="alternate" href="https://use.ink/migrate-ink-contracts-to-polkadot-frame-parachain" hreflang="en"><link data-rh="true" rel="alternate" href="https://use.ink/migrate-ink-contracts-to-polkadot-frame-parachain" hreflang="x-default"><link rel="stylesheet" href="fonts/fonts.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Montserrat:wght@400;500;700&display=swap">
<script src="https://apisa.parity.io/latest.js" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.a39b12b2.css">
<script src="/assets/js/runtime~main.186598b7.js" defer="defer"></script>
<script src="/assets/js/main.baf931cc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/text-black.svg" alt="ink!" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/text-white.svg" alt="ink!" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/">5.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/migrate-ink-contracts-to-polkadot-frame-parachain">5.x</a></li><li><a class="dropdown__link" href="/4.x/migrate-ink-contracts-to-polkadot-frame-parachain">4.x</a></li><li><a class="dropdown__link" href="/3.x/">3.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/">Overview</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">Welcome!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/why-rust-for-smart-contracts">Why Rust for Smart Contracts?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/why-webassembly-for-smart-contracts">Why WebAssembly for Smart Contracts?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/where-to-deploy">Where to deploy?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/smart-contracts-polkadot">Smart Contracts in Polkadot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/how-it-works">How it Works â€“ Substrate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ink-vs-solidity">ink! vs. Solidity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ink-vs-cosmwasm">ink! vs. CosmWasm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/migrate-ink-contracts-to-polkadot-frame-parachain">Migrating an ink! contract to a Parachain Runtime</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/setup">Getting started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/basics/contract-template">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/basics/contract-testing/overview">Testing &amp; Debugging</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/macros-attributes">Macros &amp; Attributes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/datastructures/overview">Storage &amp; Data Structures</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/linter/overview">Linter</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/frontend/overview">Frontend Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/examples/smart-contracts">Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/standards/overview">Standards</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/funding-programs">Funding Programs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/inkathon">Third Party Tools &amp; Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/faq">FAQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/brand-assets/ink">Brand Assets</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg id="prefix__Layer_1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 75 73.3" style="enable-background:new 0 0 75 73.3" xml:space="preserve" role="img" class="breadcrumbHomeIcon_YNFT"><style>.prefix__st0{opacity:.75}.prefix__st1{fill-rule:evenodd;clip-rule:evenodd;fill:#e3e3e3}.prefix__st2{fill:#fff}</style><g class="prefix__st0"><path class="prefix__st1" d="M6.9 47.1h2.4c8.8-26.7-22.6-20.4-2.4 0z"></path></g><g class="prefix__st0"><path class="prefix__st1" d="M6.9 49.1h2.4c8.8 26.7-22.6 20.4-2.4 0z"></path></g><g class="prefix__st0"><path class="prefix__st2" d="M12.2 50.6H5.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5h7.1c1.4 0 2.5 1.1 2.5 2.5s-1.1 2.5-2.5 2.5z"></path></g><g class="prefix__st0"><path class="prefix__st1" d="M37.4 19.7V5.9C37.4 2.7 40 0 43.3 0h11.9v10.7h-4.7c-1.2 0-2.2 1-2.2 2.2v6.7l-10.9.1z"></path></g><path d="m58.5 31.2-1.2-9.4c-.2-1.7-1.7-3-3.4-3H33.3c-1.7 0-3.2 1.3-3.4 3l-1.2 9.4h29.8z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff" class="prefix__st0"></path><g class="prefix__st0"><path class="prefix__st1" d="M43.6 22.9c-17.4 0-31.4 11.3-31.4 25.2s14.1 25.2 31.4 25.2S75 62 75 48.1 60.9 22.9 43.6 22.9zm0 36.5c-6.6 0-11.9-5.3-11.9-11.9S37 35.6 43.6 35.6 55.5 41 55.5 47.5s-5.4 11.9-11.9 11.9z"></path></g><path d="M38 52.8c-.6 0-1.3-.2-1.8-.7-1-1-1-2.6 0-3.5l8.4-8.4c1-1 2.6-1 3.5 0 1 1 1 2.6 0 3.5l-8.4 8.4c-.4.5-1 .7-1.7.7z" style="fill:#e3e3e3" class="prefix__st0"></path><g class="prefix__st0"><path class="prefix__st2" d="M43.6 63.7c-8.9 0-16.2-7.3-16.2-16.2s7.3-16.2 16.2-16.2 16.2 7.3 16.2 16.2-7.3 16.2-16.2 16.2zm0-27.3c-6.2 0-11.2 5-11.2 11.2s5 11.2 11.2 11.2 11.2-5 11.2-11.2-5.1-11.2-11.2-11.2z"></path></g><g class="prefix__st0"><path class="prefix__st2" d="M52.8 0h5v10.7h-5z"></path></g></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Overview</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migrating an ink! contract to a Parachain Runtime</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 5.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><img src="/img/title/polkadot.svg" class="titlePic">
<h1>Migrating an ink! contract to a Parachain Runtime</h1>
<p>Smart contracts written in <code>ink!</code> are a great starting point for developing applications in the Polkadot ecosystem. Developers can go from an idea to a fully functioning web3 application &quot;in production&quot; in a matter of hours or days. This allows faster feedback on ideas, to validate whether there is user demand in the first place, and to easily iterate and refine the implementation.</p>
<p>For many applications, smart contracts are good enough. However, they are exposed to the inherent limitations of the smart contract execution environment:</p>
<ol>
<li>Sharing of blockspace with other smart contracts, volatile &quot;gas&quot; fees.</li>
<li>Default model enforces gas fees being paid by the end user.</li>
<li>Relative poor performance of interpreted smart contract (untrusted) code compared to pre-compiled Parachain runtime (trusted) code.</li>
<li>Limited access to the host chain environment and any special functionality provided by an extensive suite of customisable FRAME pallets.</li>
</ol>
<p>Once a web3 application has proven it can work, the team may consider &quot;upgrading&quot; to a Parachain to unlock the full power of a dedicated App Chain. Compared to developing and deploying a smart contract, this requires considerably more time and expertise, which is why we encourage to start with <code>ink!</code> where possible, at least at the prototype stage.</p>
<p>Much of the difficulty in launching a parachain comes in configuring a node implementation, bootstrapping and maintaining a collator network, deploying to testnets, managing infrastructure, acquiring &quot;Coretime&quot; (previously via a slot auction). All of which is time consuming and costly. This is important to note because this guide will focus on the migration of the code from <code>ink!</code> to <code>FRAME</code>, which might be a learning curve but overall a minor part of the overall migration, and a one-off cost.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="utilizing-existing-frame-pallets">Utilizing existing FRAME pallets<a href="#utilizing-existing-frame-pallets" class="hash-link" aria-label="Direct link to Utilizing existing FRAME pallets" title="Direct link to Utilizing existing FRAME pallets">â€‹</a></h2>
<p>There is a rich library of FRAME pallets, which may provide a drop in replacement for some (or all) of your smart contract functionality. For example, for a <a href="/standards/overview">PSP22</a> (similar to ERC20) fungible token contract, this could be replaced either by the native Parachain token itself via <code>pallet_balances</code> or by an asset on <code>pallet_assets</code>. Governance functions could be replaced by e.g. <code>pallet_democracy</code>, and so on. See <a href="https://github.com/paritytech/polkadot-sdk/tree/master/substrate/frame" target="_blank" rel="noopener noreferrer"><code>polkadot-sdk</code></a> for a range of pre-built pallets which can be used to handle some common functions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="similarities-and-differences-between-ink-and-frame">Similarities and differences between <code>ink!</code> and <code>FRAME</code><a href="#similarities-and-differences-between-ink-and-frame" class="hash-link" aria-label="Direct link to similarities-and-differences-between-ink-and-frame" title="Direct link to similarities-and-differences-between-ink-and-frame">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="similar">Similar<a href="#similar" class="hash-link" aria-label="Direct link to Similar" title="Direct link to Similar">â€‹</a></h3>
<p>The biggest advantage we have when migrating from <code>ink!</code> to <code>FRAME</code> is that both are Rust based DSLs, in both cases actual Rust (or Rust-like)  code annotated with attributes expands into Rust code for handling all the boilerplate for integrating into their respective execution environments. Indeed the modern <code>FRAME 2.0</code> was originally inspired by the <code>ink!</code> approach of attribute macros annotating Rust code.</p>
<p>So we can assume that the developer performing the migration is already familiar with Rust and its development environment, which is already a huge headstart for developing with <code>FRAME</code>.</p>
<p>Next we can assume some familiarity with the execution environment, after all a contract is running inside of <code>pallet_contracts</code> and is invoked in a similar way via a pallet dispatchable, has access to storage (sandboxed to the contract), and can emit events.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="different">Different<a href="#different" class="hash-link" aria-label="Direct link to Different" title="Direct link to Different">â€‹</a></h3>
<p>The biggest difference is that a contract is user uploaded and therefore untrusted code, so there are restrictions to what the contract is able to do and it will perform slower because it is interpreted. For example, a contract can only read and write from its own sandboxed storage.</p>
<p>Runtime code built using <code>FRAME</code> is trusted, can be pre-compiled and therefore executes significantly faster (though that may change if/when contracts are able to target <a href="https://forum.polkadot.network/t/announcing-polkavm-a-new-risc-v-based-vm-for-smart-contracts-and-possibly-more/3811" target="_blank" rel="noopener noreferrer">PolkaVM</a>). Pallets have direct access to other pallets and have full access to the Parachain storage, and the permissioning can be configured as desired.</p>
<p>Because <code>ink!</code> is executing in a more constrained environment, it is able to be much more opinionated and therefore a simpler language. Because execution is metered (pay as you go execution by the user), there is no need to worry about benchmarking for &quot;weight&quot; calculation. <code>FRAME</code> is more powerful, but necessarily more complicated.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-migration">Example Migration<a href="#example-migration" class="hash-link" aria-label="Direct link to Example Migration" title="Direct link to Example Migration">â€‹</a></h2>
<p>We&#x27;ll use the <a href="https://github.com/use-ink/ink-examples/blob/main/dns/lib.rs" target="_blank" rel="noopener noreferrer"><code>DNS</code> example</a> contract to demonstrate a migration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">â€‹</a></h3>
<p>Start by cloning the <a href="https://github.com/substrate-developer-hub/substrate-parachain-template/" target="_blank" rel="noopener noreferrer">Parachain Template</a> which contains a <a href="https://github.com/substrate-developer-hub/substrate-parachain-template/blob/main/pallets/template/src/lib.rs" target="_blank" rel="noopener noreferrer">template pallet</a> which we can modify.</p>
<p>Now we will move down the contract from top to bottom and begin the migration of code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-definitions">Event Definitions<a href="#event-definitions" class="hash-link" aria-label="Direct link to Event Definitions" title="Direct link to Event Definitions">â€‹</a></h3>
<p>First thing we encounter are events. E.g.:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token attribute attr-name" style="color:#c4b9fe">#[ink(event)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Register</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#c4b9fe">#[ink(topic)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    name</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token class-name">Hash</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#c4b9fe">#[ink(topic)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    from</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Each of these structs annotated with <code>#[ink(event)]</code> can be translated to a variant in the pallet <code>Error</code> enum annotated with <code>#[pallet::error]</code>. Any of the <code>ink!</code> environment type aliases (both <code>Hash</code> and <code>AccountId</code> in the above example) must be translated to their equivalent associated type on the <code>Config</code> trait e.g. <code>AccountId</code> -&gt; <code>T::AccountId</code>. Also the <code>#[ink(topic)]</code> annotations must be removed: topics must be calculated manually when the event is emitted, and will be covered later. Remove the <code>#[pallet::generate_deposit(pub(super) fn deposit_event)]</code> and the final <code>Event</code> type will look like:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[pallet::event]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub enum Event&lt;T: Config&gt; {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    Register {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        name: T::Hash,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        from: T::AccountId,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    SetAddress {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        name: T::Hash,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        from: T::AccountId,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        old_address: Option&lt;T::AccountId&gt;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        new_address: T::AccountId,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    Transfer {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        name: T::Hash,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        from: T::AccountId,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        old_owner: Option&lt;T::AccountId&gt;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        new_owner: T::AccountId,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage">Storage<a href="#storage" class="hash-link" aria-label="Direct link to Storage" title="Direct link to Storage">â€‹</a></h3>
<p>The storage layout of the contract is defined by the following struct:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[ink(storage)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub struct DomainNameService {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// A hashmap to store all name to addresses mapping.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    name_to_address: Mapping&lt;Hash, AccountId&gt;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// A hashmap to store all name to owners mapping.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    name_to_owner: Mapping&lt;Hash, AccountId&gt;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// The default address.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    default_address: AccountId,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In <code>ink!</code>, the layout of the contract storage is defined by this top level <code>struct</code>. A brief recap of how this is used:</p>
<ul>
<li>Constructors must return an initialized instance of this struct, which is then written to storage.</li>
<li>Non mutable messages e.g. <code>#[ink(message)] fn message(&amp;self, ..)</code> will load an instance of this struct and pass it as <code>&amp;self</code>.</li>
<li>Mutable messages e.g. <code>#[ink(message)] fn message(&amp;mut self, ..)</code>, will load an instance of the struct and persist it if the message succeeds in executing.</li>
<li>Fields of type <code>Mapping</code> or <code>Lazy</code> are not written directly into the same storage slot as the parent, but are wrappers around direct reads/writes to storage under many or a single key respectively.</li>
</ul>
<p>In <code>FRAME</code>, all storage operations happen eagerly via &quot;type aliases&quot; annotated with <code>#[pallet::storage]</code>. So for each field in the <code>#[ink(storage)]</code> struct, we require a corresponding pallet storage definition.</p>
<p><code>default_address: AccountId</code> translates to:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token attribute attr-name" style="color:#c4b9fe">#[pallet::storage]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">type</span><span class="token plain"> </span><span class="token type-definition class-name">DefaultAddress</span><span class="token operator" style="color:#e09142">&lt;</span><span class="token class-name">T</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token class-name">Config</span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token class-name">StorageValue</span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain">_</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#6c6783">::</span><span class="token class-name">AccountId</span><span class="token operator" style="color:#e09142">&gt;</span><span class="token punctuation" style="color:#6c6783">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>name_to_address: Mapping&lt;Hash, AccountId&gt;,</code> translates to a <code>StorageMap</code> like so:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[pallet::storage]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub type NameToAddress&lt;T: Config&gt; = StorageMap&lt;_, Blake2_128Concat, T::Hash, T::AccountId&gt;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>name_to_owner: Mapping&lt;Hash, AccountId&gt;,</code> also translates to a <code>StorageMap</code>:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[pallet::storage]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub type NameToOwner&lt;T: Config&gt; = StorageMap&lt;_, Blake2_128Concat, T::Hash, T::AccountId&gt;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Reading and writing these storage values must all be done explicitly, in contrast with <code>ink!</code> which can do so automatically for non &quot;lazy&quot; values. When it comes to migrating the messages, this will be demonstrated.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="error-definition">Error Definition<a href="#error-definition" class="hash-link" aria-label="Direct link to Error Definition" title="Direct link to Error Definition">â€‹</a></h3>
<p>Simply copy across the variants of the <code>enum Error</code> to the equivalent <code>#[pallet::error]</code> definition. In our case we end up with:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[pallet::error]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub enum Error&lt;T&gt; {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returned if the name already exists upon registration.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    NameAlreadyExists,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returned if caller is not owner while required to.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    CallerIsNotOwner,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that the <code>T</code> generic parameter is not used in this case, the <code>error</code> macro handles the generation of <code>PhantomData&lt;T&gt;</code>. If we use some environmental types we can use the <code>T</code> similar to the event definition.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="constructors">Constructors<a href="#constructors" class="hash-link" aria-label="Direct link to Constructors" title="Direct link to Constructors">â€‹</a></h3>
<p>In this example, the single constructor is simply initializing the storage to empty values.</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain"> #[ink(constructor)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn new() -&gt; Self {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    Default::default()</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This code is executed when the contract instance was initialized.</p>
<p>Our use case is a migration, so we will assume that the existing data must be migrated from contract storage to the pallet storage. This will be covered in the <a href="#data-migration">Data Migration</a> section.</p>
<p>No code migration is required then for this constructor.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="messages">Messages<a href="#messages" class="hash-link" aria-label="Direct link to Messages" title="Direct link to Messages">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mutable">Mutable<a href="#mutable" class="hash-link" aria-label="Direct link to Mutable" title="Direct link to Mutable">â€‹</a></h4>
<p>There are 3 mutable messages (that can change the state of the contract): <code>register</code>, <code>set_address</code> and <code>transfer</code>. This guide will demonstrate <code>register</code>, and the other two can follow a similar pattern. The message is defined as so, with added numerical comments to show the translation to the equivalent <code>FRAME</code> code.</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[ink(message)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn register(&amp;mut self, name: Hash) -&gt; Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 1.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    let caller = self.env().caller();</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 2.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    if self.name_to_owner.contains(name) {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        return Err(Error::NameAlreadyExists)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 3.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    self.name_to_owner.insert(name, &amp;caller);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 4.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    self.env().emit_event(Register { name, from: caller });</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 5.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    Ok(())</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Before proceeding, it is necessary to add a custom <code>deposit_event</code> function for raising events which accepts topics:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">impl&lt;T: Config&gt; Pallet&lt;T&gt; {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    fn deposit_event(topics: Vec&lt;T::Hash&gt;, event: Event&lt;T&gt;) {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &lt;frame_system::Pallet&lt;T&gt;&gt;::deposit_event_indexed(</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            &amp;topics,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            &lt;T as Config&gt;::RuntimeEvent::from(event).into()</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we can translate the <code>register</code> message into a &quot;Dispatchable&quot;:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[pallet::call_index(0)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">#[pallet::weight(Weight::from_parts(10_000, 0)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .saturating_add(T::DbWeight::get().reads(1))</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .saturating_add(T::DbWeight::get().writes(1)))]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn register(origin: OriginFor&lt;T&gt;, name: T::Hash) -&gt; DispatchResultWithPostInfo {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 1.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    let caller = ensure_signed(origin)?;</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 2.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    ensure!(!NameToOwner::&lt;T&gt;::contains_key(&amp;name), Error::&lt;T&gt;::NameAlreadyExists);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 3.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    &lt;NameToOwner&lt;T&gt;&gt;::insert(name, &amp;caller);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 4.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    Self::deposit_event(</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        &amp;[name.clone(), T::Hashing::hash_of(&amp;caller)],</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Event::Register { name, from: caller }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // 5.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    Ok(().into())</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Compare the numbered annotations from the <code>ink!</code> contract message and the <code>FRAME</code> dispatchable, and you can see they are very similar, just different APIs for interacting with the environment and with storage.</p>
<p>For <code>4.</code>, in <code>FRAME</code> we need to generate the topic list manually which is done automatically in <code>ink!</code> via the annotations.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="weights">Weights<a href="#weights" class="hash-link" aria-label="Direct link to Weights" title="Direct link to Weights">â€‹</a></h4>
<p>The <code>pallet::weight</code> attribute defines the <code>weight</code> of the dispatchable i.e. the amount of onchain resources it is estimated to consume. Because we are now writing trusted code, we can define this up front (no runtime gas metering). The number in the <code>weight</code> is typically generated via a benchmarking process. It is important to integrate this process and set a non-arbitrary value here before deploying to a production chain. Read more <a href="https://docs.substrate.io/build/tx-weights-fees/" target="_blank" rel="noopener noreferrer">https://docs.substrate.io/build/tx-weights-fees/</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="immutable-read-only-messages">Immutable (read only) messages<a href="#immutable-read-only-messages" class="hash-link" aria-label="Direct link to Immutable (read only) messages" title="Direct link to Immutable (read only) messages">â€‹</a></h4>
<p><code>ink!</code> messages can return a value, which when executed as an RPC &quot;dry-run&quot; (not via a transaction), are used to read the state of contracts. Dispatchables in <code>FRAME</code> cannot return values directly. There are two ways to read the state from a FRAME pallet:</p>
<ol>
<li>Reading from <code>#[pallet::storage]</code> items directly, client libraries will generate an API to do this from the runtime metadata. See e.g. <a href="https://github.com/paritytech/subxt/blob/master/subxt/examples/storage_fetch.rs" target="_blank" rel="noopener noreferrer"><code>subxt</code></a></li>
<li>Via runtime APIs, RPC methods that can be wired up directly into query methods on a pallet. See <a href="https://docs.substrate.io/reference/runtime-apis/" target="_blank" rel="noopener noreferrer">https://docs.substrate.io/reference/runtime-apis/</a>.</li>
</ol>
<p>In our case, <code>1.</code> is good enough, so the following read only message:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[ink(message)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn get_address(&amp;self, name: Hash) -&gt; AccountId {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    self.get_address_or_default(name)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">fn get_address_or_default(&amp;self, name: Hash) -&gt; AccountId {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    self.name_to_address</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        .get(name)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        .unwrap_or(self.default_address)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Can be queried <em>without</em> any modifications to the <code>NameToAddress</code> storage type:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[pallet::storage]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub type NameToAddress&lt;T: Config&gt; = StorageMap&lt;_, Blake2_128Concat, T::Hash, T::AccountId&gt;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>subxt</code> would generate the following accessor for querying the storage:</p>
<div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">let storage_query = my_custom_chain::storage().dns().name_to_address(&amp;name);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">// Use that query to `fetch` a result. This returns an `Option&lt;_&gt;`, which will be</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">// `None` if no value exists at the given address. You can also use `fetch_default`</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">// where applicable, which will return the default value if none exists.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">let result = api</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .storage()</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .at_latest()</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .await?</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .fetch(&amp;storage_query)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .await?;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-migration">Data Migration<a href="#data-migration" class="hash-link" aria-label="Direct link to Data Migration" title="Direct link to Data Migration">â€‹</a></h3>
<p>Data migration can be done at either genesis time or once the custom parachain is up and running.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="retrieving-the-data-from-the-contract">Retrieving the data from the contract<a href="#retrieving-the-data-from-the-contract" class="hash-link" aria-label="Direct link to Retrieving the data from the contract" title="Direct link to Retrieving the data from the contract">â€‹</a></h4>
<p>In both cases the first steps are to first download the current state of the contract at a fixed point in time, and then ensuring that no changes can be made to the contract after that.</p>
<p>This could be done by using <code>set_code_hash</code> to update the source code of the contract to a special contract which allows only querying and downloading the state of the current contract, and no mutating messages.</p>
<p>An alternative would be querying the contract storage directly, but currently there are no good tools for this, and it would require some key calculation for retrieving the data at all storage locations. Additionally the contract would still need to be &quot;frozen&quot; somehow to ensure no changes can be made to the contract state.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="initializing-the-pallet">Initializing the pallet<a href="#initializing-the-pallet" class="hash-link" aria-label="Direct link to Initializing the pallet" title="Direct link to Initializing the pallet">â€‹</a></h4>
<p>Once the data has been downloaded and serialized, it can be used to initialize the state of the custom parachain runtime. This can be hardcoded in a <code>#[pallet::genesis_build]</code> impl block. See <a href="https://docs.substrate.io/reference/how-to-guides/basics/configure-genesis-state/" target="_blank" rel="noopener noreferrer">https://docs.substrate.io/reference/how-to-guides/basics/configure-genesis-state/</a>.</p>
<p>Alternatively the state could be initialized via dispatchable extrinsic(s) which initialize the storage.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="adjusting-uis">Adjusting UIs<a href="#adjusting-uis" class="hash-link" aria-label="Direct link to Adjusting UIs" title="Direct link to Adjusting UIs">â€‹</a></h3>
<p>User interfaces will need to be adjusted to interact with a pallet rather than a contract. This should be relatively straightforward since client libraries usually have first-class support for interacting with Substrate pallets, and the signing etc. should already be integrated.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/use-ink/ink-docs/edit/master/docs/intro/migrate-to-parachain.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ink-vs-cosmwasm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ink! vs. CosmWasm</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/getting-started/setup"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Setup</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#utilizing-existing-frame-pallets" class="table-of-contents__link toc-highlight">Utilizing existing FRAME pallets</a></li><li><a href="#similarities-and-differences-between-ink-and-frame" class="table-of-contents__link toc-highlight">Similarities and differences between <code>ink!</code> and <code>FRAME</code></a><ul><li><a href="#similar" class="table-of-contents__link toc-highlight">Similar</a></li><li><a href="#different" class="table-of-contents__link toc-highlight">Different</a></li></ul></li><li><a href="#example-migration" class="table-of-contents__link toc-highlight">Example Migration</a><ul><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#event-definitions" class="table-of-contents__link toc-highlight">Event Definitions</a></li><li><a href="#storage" class="table-of-contents__link toc-highlight">Storage</a></li><li><a href="#error-definition" class="table-of-contents__link toc-highlight">Error Definition</a></li><li><a href="#constructors" class="table-of-contents__link toc-highlight">Constructors</a></li><li><a href="#messages" class="table-of-contents__link toc-highlight">Messages</a></li><li><a href="#data-migration" class="table-of-contents__link toc-highlight">Data Migration</a></li><li><a href="#adjusting-uis" class="table-of-contents__link toc-highlight">Adjusting UIs</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>